<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Meteo Proxy Deno</title>
<style>
  body {
    font-family: Arial, sans-serif;
    max-width: 480px;
    margin: auto;
    padding: 1rem;
  }
  input, button {
    padding: 0.5rem;
    font-size: 1rem;
    margin: 0.5rem 0;
    width: 100%;
  }
  .day {
    margin-top: 1rem;
  }
</style>
</head>
<body>
  <h1>Meteo Proxy Deno</h1>
  <input type="text" id="cityInput" placeholder="Scrivi una città (es. Milano)" />
  <button onclick="fetchWeather()">Mostra meteo</button>
  <div id="result"></div>

  <script>
    const proxyUrl = "https://share-otter-21.deno.dev";

    async function fetchWeather() {
      const city = document.getElementById("cityInput").value.trim();
      if (!city) return alert("Inserisci una città");

      try {
        const res = await fetch(`${proxyUrl}?city=${encodeURIComponent(city)}`);
        if (!res.ok) throw new Error("Errore nella richiesta");

        const data = await res.json();

        if(data.error) {
          alert(data.error);
          return;
        }

        const resultDiv = document.getElementById("result");
        resultDiv.innerHTML = "";

        ["Oggi", "Domani", "Dopodomani"].forEach((label, i) => {
          const day = data.consolidated_weather[i];
          if(day) {
            resultDiv.innerHTML += `
              <div class="day">
                <strong>${label}</strong>: ${day.weather_state_name}, ${Math.round(day.the_temp)}°C
              </div>`;
          }
        });

      } catch (e) {
        alert("Errore: " + e.message);
      }
    }
  </script>
</body>
</html>
